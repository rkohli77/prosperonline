// File: functions/test_vector_search.ts
declare const SUPABASE_URL: string;
declare const SUPABASE_SERVICE_ROLE_KEY: string;

const CORS_HEADERS = {
  "Content-Type": "application/json",
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Methods": "GET, POST, OPTIONS",
  "Access-Control-Allow-Headers": "Content-Type",
};

export async function onRequestGet() {
  try {
    // Example: copy a real embedding array from your website_content table
    const testEmbedding = [
      -0.050794665,0.009402173,0.017213428,0.01589483,0.017543077,-0.015249865,-0.01705577,-0.04526229,0.0127416635,-0.01954964,0.05128197,-0.0030474649,0.031760998,0.0468962,0.024523044,0.037637357,0.013171641,0.024781032,-0.010412619,0.02872249,0.015092206,-0.007890086,-0.015335861,0.012240023,-0.050479345,-0.013802274,-0.00030434338,0.024121732,0.057846293,-0.038525976,0.020094277,-0.015966494,0.036576744,0.020065611,0.021255216,-0.00900086,-0.001073152,0.009223015,-0.022315826,0.062432718,-0.0053568017,-0.026873587,0.06065548,0.0108999275,0.018274039,0.006650317,-0.043341722,-0.019606968,0.009738988,0.052027266,0.039758578,-0.00615226,0.007983247,0.05778896,0.007126875,0.009953977,-0.018718349,0.012913655,0.035688125,0.04738351,0.010068637,-0.026801925,-0.009258847,0.0025207426,0.043255728,0.007546103,-0.022631144,-0.027547218,-0.03766602,0.029955093,0.014569067,-0.016009491,0.03548747,-0.031589005,0.051797945,0.014963213,-0.01943498,0.01413909,-0.0029973008,-0.009588496,0.0116237225,0.0023415852,-0.04950473,-0.03416887,-0.024021404,-0.013472625,-0.06914037,0.035860114,-0.023648757,0.087658055,-0.00065481977,0.05062267,-0.036232762,-0.0012290187,-0.025984967,-0.00025821038,-0.0053102206,6.953541e-05,0.015335861,0.025282672,0.055753734,-0.034082875,-0.029926427,0.00081023865,0.049189415,-0.0017611157,0.0007811256,-0.024981687,-0.029338792,0.029582445,-0.023247445,-0.0073024496,0.01943498,0.008621047,0.05004937,-0.012569672,0.047928147,-0.017070103,0.0029345958,-0.032964934,-0.019563971,0.02188585,0.058190275,-0.05248591,0.019105328,0.010340956,-0.022688475,-0.021212218,-0.1039972,0.018116381,0.040647198,0.009588496,0.0018023219,-0.036032107,0.020251935,-0.014354079,-0.017743735,0.00977482,-0.04460299,0.031732332,0.04351371,-0.012469345,0.0014359454,0.021799855,-0.029080804,0.009402173,-0.009301844,0.046236902,-0.016253145,-0.04405835,-0.028177852,-0.022760136,-0.035028826,-0.018130714,-0.00977482,0.053345863,0.041851133,0.02300379,-0.032305636,0.017342422,-0.01788706,0.0016984107,0.0399019,0.018990668,-0.023548428,0.04090518,-0.01002564,-0.027575884,-0.049418736,-0.013802274,-0.027188905,-0.03666274,0.0054033827,-0.0023433769,0.025640985,0.014031596,0.023906743,0.0034595265,0.005317387,0.034426857,0.027604548,0.035544798,0.034942828,-0.02860783,0.00487666,0.008864701,0.016640125,-0.012705832,0.021928847,0.017958723,0.011867376,0.05110998,0.062318057,0.036691405,0.03700672,0.0061200117,-0.003357407,0.04199446,-0.0089005325,0.022459153,0.018216709,0.016855113,-0.02499602,0.0056685354,-0.059795525,-0.02294646,-0.009796319,0.026486607,0.0014260917,-0.023548428,0.026687264,-0.0066467337,0.027647547,0.05589706,0.009982642,0.026343282,0.0042854412,0.0047082524,-0.01438991,0.011838711,-0.03961525,0.0036548078,0.024207728,-0.011910374,-0.01939198,0.058132943,0.045921586,-0.0285075,-0.03190432,0.040589865,0.03339491,0.002124805,0.011824379,0.023433767,0.0043965187,-0.03250629,0.0018524859,-0.0076034334,-0.013207472,-0.054148488,-0.0038339652,0.044574324,-0.040647198,0.008986528,0.036347423,0.031589005,0.0018085925,-0.043800365,-0.02427939,0.0049877376,-0.016511133,0.022287162,-0.0039163777,0.015794503,0.02843584,-0.019148327,-0.032563623,0.043915026,-0.019005,-0.03927127,0.0077324267,-0.036576744,0.026916586,-0.0025529908,0.0035347724,-0.01995095,-0.008728541,0.018374367,-0.0077969236,-0.00061316567,0.022229832,0.031846993,0.008606714,-0.01943498,-0.025640985,0.015722841,-0.02943912,0.0171131,-0.041191835,0.00020502308,-0.029023474,0.0014914841,-0.017141765,0.00038406835,-0.022186834,0.009581329,-0.044803645,0.05821894,0.0026049465,0.013909769,-0.021355543,-0.010534447,0.022860466,-0.052027266,0.026715929,0.08341561,0.0041206167,-0.042539097,-0.004966239,-0.017801065,0.03872663,-0.010735102,-0.008470555,-0.015063542,0.006112845,-0.011616556,0.03305093,0.016095487,-0.003855464,-0.025168011,0.01638214,0.026099628,-0.013995764,-0.031760998,-0.025870306,-0.046150908,0.03855464,0.011602224,0.03305093,-0.044459663,0.049705386,-0.025425997,-0.040446542,-0.043456383,0.024193395,0.0052528908,0.04815747,-0.018016053,0.025540657,0.008613881,-0.0024204145,-0.067649774,-0.025755646,-0.054320477,-0.02061025,-0.03528681,-0.05905023,-0.022143835,-0.0418798,-0.004131366,-0.03838265,-0.069656335,0.0027357312,-0.05821894,0.035745453,-0.0412205,0.008642546,-0.03909928,0.010856929,0.006080597,-0.04417301,0.002590614,-0.01977896,0.012763162,-0.033796225,-0.0035616462,-0.003730054,0.004346355,-0.0017960514,0.057702966,-0.013995764,-0.0018211334,-0.0077395933,-0.051826607,0.020022614,0.0139384335,-0.06753512,-0.042539097,0.042539097,0.030270409,0.060082175,-0.061916746,0.036433417,-5.587467e-05,-0.056814346,-0.011953372,0.023290442,0.019033667,0.03565946,0.019621301,0.056212377,-0.032448962,-0.012870656,-0.04133516,0.034828167,-0.046924867,-0.012763162,0.05687168,-0.017600408,-0.025139345,0.051855274,0.025067681,-0.006747062,0.006173759,0.0028736822,-0.0215562,0.031044368,0.036146767,-0.01444724,-0.0051274803,0.010054305,-0.012576839,-0.01782973,-0.023218779,-0.037350703,-0.015794503,-0.008269899,0.03439819,0.03801,-0.042195115,0.0058190273,-0.048530117,0.050135363,-0.010534447,0.009566997,-0.02399274,-0.019291652,-0.06936969,0.012347518,0.05360385,0.00090832723,-0.008076409,-0.017313756,-0.021427207,0.008341561,0.0069799665,0.04772749,-0.009352009,0.021971844,-0.05555308,-0.039471924,0.03517215,0.018732682,0.009961143,0.010297959,-0.024680702,-0.0111364145,-0.022014843,0.019262988,0.014454407,0.013651783,0.007897251,-0.09534032,-0.013142976,-0.04110584,-0.03339491,-0.0021104724,0.025454663,-0.04950473,-0.0067112306,-0.0054033827,-0.017184764,0.018876007,-0.012985317,-0.001211103,-0.0028880148,0.020653248,-0.023204448,-0.025769979,0.013809441,0.014511737,0.04649489,-0.04526229,0.012118196,0.037465364,0.036519412,0.016267478,0.014977546,0.02161353,-0.024981687,0.033595566,-0.007531771,0.027862536,0.02182852,-0.07418543,0.0074027777,-0.056585025,-0.047240183,-0.017858395,-0.053345863,-0.0022967958,-0.03901328,-0.039586585,0.007438609,0.04560627,0.067649774,-0.006944135,-0.035946112,-0.0056936173,-0.028966144,-0.03944326,0.03178966,0.038927287,-0.018847343,-0.06615919,0.023634424,-0.04076186,-0.014569067,-0.004482514,0.007366946,0.016210148,-0.012548174,-0.04316973,0.060254168,0.042195115,0.031846993,-0.04560627,0.013006817,0.01593783,0.030270409,-0.0171131,0.013343632,-0.038927287,-0.0061809253,0.0077324267,0.013587286,-0.00015239563,0.04589292,-0.0043893526,-0.039242603,-0.037092716,0.020624582,0.013544288,-0.03571679,0.0077037616,-0.020266268,-0.002581656,-0.04738351,-0.007875753,-0.04572093,0.0014153422,-0.033366244,0.02499602,-0.014733892,-0.00024947646,0.008592382,0.009832149,-0.023763418,-0.014669396,-0.006320668,0.025340002,0.03190432,-0.013221805,0.0053496356,-0.0039414596,0.014640731,-0.00894353,0.03629009,0.0070874607,-0.011924706,0.009652993,-0.0304424,0.013916935,-0.003927127,0.033738893,-0.0074457754,-0.0019832707,0.014920216,-0.04150715,0.011924706,-0.0031818328,0.03376756,0.024422716,-0.0007797819,0.012103864,-0.03548747,0.020638915,-0.0057867793,-0.02949645,-0.037866674,-0.0034595265,0.014024429,0.016181482,0.020839572,0.0071734563,-0.006435328,-0.07143358,0.0016115195,0.00026627246,0.005535959,-0.025096348,-0.026228622,-0.008513552,0.019879289,-0.02777654,0.046150908,0.033308916,0.037809346,-0.008642546,0.009645826,0.015393191,0.0058512758,0.0056506195,0.013357964,0.0054248814,-0.013902603,-0.00709821,0.0052851387,0.045462944,0.022702806,0.020352263,-0.056585025,0.013615951,-0.0067900596,-0.0006310814,-0.027360896,0.00615226,0.010412619,0.020022614,-0.014167755,0.021842852,0.03849731,0.018145045,-0.009918145,-0.0059731025,0.007388445,-0.045978915,-0.023075454,0.021814186,-0.017414084,-0.016912444,0.027074244,0.027203236,0.015593847,-0.012490843,0.017012773,-0.019907953,-0.020595917,-0.030843712,0.0047834986,-0.014848553,0.011143581,0.00070632744,-0.010104469,0.008449056,0.032248303,-0.027762208,-0.010434118,0.018861676,-0.04210912,0.0020370178,0.011838711,0.06575788,-0.02466637,0.038153328,0.0148342205,-0.012784662,-0.002760813,0.008821703,-0.018317036,2.5655878e-05,-0.01954964,0.020022614,0.010985922,0.009237348,-0.03138835,-0.03861197,-0.03227697,-0.015407523,-0.00061540515,-0.032190975,0.037092716,-0.027203236,-0.0025529908,-0.0006910991,-0.0067327293,0.009602829,-0.012920821,0.00969599,-0.0158375,-0.0032821607,0.03517215,0.0659872,0.027905533,0.020624582,0.0010220921,-0.0015174618,-0.026242955,-0.032133643,0.015378858,0.0646686,0.0011492937,-0.023978407,-0.0032785777,0.0049984874,0.010598943,0.011114916,-0.038697965,0.009459503,0.007990413,0.04701086,0.025683982,0.01046995,-0.029252796,0.012469345,0.020767909,0.018675352,-0.004579259,-0.0042424435,0.016210148,0.0042890245,-0.012791827,0.015479187,-0.023792082,-0.043915026,-0.018044718,0.019664299,0.024408383,0.04589292,-0.0027841036,-0.016898112,-0.014554735,-0.030643055,-0.036519412,0.00018531577,-0.0068581393,-0.012712998,-0.029467784,0.022846133,0.012161194,0.015350193,-0.03032774,-0.006872472,-0.022731472,-0.031159028,-0.0072379527,0.0058512758,0.0110575855,0.024967354,0.010892761,0.0080979075,0.028593497,-0.025354333,0.030471064,0.0069548846,0.025927637,-0.0589929,-0.013329299,-0.0036870562,-0.009581329,-0.012956652,-0.05328853,0.022989457,0.035630792,0.007169873,-0.030299073,0.032534957,0.01995095,-0.019205658,0.012433513,0.0016697455,0.011845877,-0.013164475,0.0034129457,0.025454663,-0.028077524,-0.022301495,-0.024480047,0.015092206,-0.028908813,0.067649774,-0.0023397936,0.007431443,0.017715069,0.013644616,0.0021033061,-0.021599198,0.006876055,-0.015909163,0.013214638,0.045319617,-0.05411982,-0.04021722,-0.016984107,0.043026406,-0.022072174,-0.0025082014,-0.025683982,0.003661974,0.015507852,-0.015780171,-0.014891551,-0.013006817,-0.04359971,0.017428417,-0.04351371,0.019406313,-0.047956813,0.035344142,-0.025125012,0.0047906647,-0.0059480206,0.001810384,-0.027217569,0.014948881,-0.03712138,-0.0035723955,-0.060540818,0.012569672,0.019420646,-0.00017008741,0.019191325,0.021771189,-0.018546358,-0.015851833,0.039357264,0.031703666,0.00880737,0.05589706,0.008047744,-0.013343632,0.011824379,-0.03789534,0.02938179,0.002137346,0.006195258,0.006818725,-0.008155238,0.015808836,-0.019879289,0.029754436,0.009674491,-0.006919053,-0.017743735,-0.009660159,0.01527853,-0.06375132,0.029811766,0.0062167565,-0.035458803,0.034340862,-0.024035737,-0.025741313,-0.022115171,0.036634073,0.031073034,-0.008219735,-0.02632895,-0.058677584,-0.021169221,0.022674141,0.0043320223,-0.020696245,-0.01755741,0.02244482,-0.046408895,0.008678377,-0.018044718,-0.017643405,-0.01883301,-0.010161799,-0.031417016,0.00424961,-0.014081759,0.014031596,0.00093520083,-0.018274039,-0.03637609,-0.0007372321,0.007198538,-0.043800365,0.01247651,-0.01744275,-0.057817627,0.027045578,0.011036087,0.01943498,-0.020925567,0.06237539,0.0057688635,0.02489569,0.044631653,0.053345863,-0.040446542,-0.0046867537,0.030041087,-0.031015703,0.015923496,0.013042647,-0.0072845337,0.018474696,-0.018417366,-0.0015900206,-0.0024956604,-0.020595917,-0.013379463,-0.013522789,-0.002459829,-0.008026245,0.0012030409,0.02066758,0.00016180139,-0.0066109025,-0.028106188,-0.02466637,0.030155748,-0.01972163,-0.015966494,-0.01325047,0.01247651,0.005879941,-0.0025082014,0.019477976,-0.03540147,-0.011537727,0.007126875,0.012146861,-0.0055431253,0.04577826,-0.020352263,0.0068079755,-0.03376756,0.008914865,-0.014597733,0.034140207,-0.005897857,-0.024637705,0.0399879,0.00045685098,0.01655413,0.0083343955,-0.025340002,-0.020739242,-0.02650094,-0.0078614205,0.03199032,0.008262732,-0.0019599802,0.035258148,-0.009989808,0.018073384,-0.0017575326,0.023519764,0.0066646496,0.0022985875,-0.043743033,-0.0072809504,0.026730262,0.017270759,-0.0037408033,0.017414084,-0.04110584,0.021756856,-0.0026730262,0.03909928,-0.021527534,-0.012232857,0.015622512,0.034426857,-0.030356403,0.0137019465,0.00963866,0.045520272,-0.024351053,-0.026758926,0.0122543555,0.0043141064,0.0024705785,0.011888875,0.03376756,-0.05004937,0.013737778,-0.021584865,0.014017263,-0.015651178,0.015565182,0.017973056,0.0017638031,0.03548747,0.0067291465,-0.03439819,0.032964934,0.06879638,0.02333344,0.010792432,-0.0037945504,0.03583145,0.014948881,0.025927637,0.034541517,-0.003905628,0.051740613,0.020352263,-0.0010346331,-0.026156958,0.050364684,0.0152212,0.0115448935,-0.004890993,0.0068509732,0.013013982,-0.005084483,0.03187566,0.0076535977,-0.03915661,-0.0115448935,0.0047333343,0.00084427855,0.01166672,-0.0027124407,0.00071349373,-0.0027231902,0.007890086,-0.046867535,0.027733542,0.0047190017,0.022674141,0.005790362,-0.020724911,-0.040073894,0.0079402495,-0.020524254,0.0027231902,-0.012877823,0.008828869,-0.0005079108,-0.01939198,-0.009309011,0.015651178,0.00797608,0.014418575,-0.011824379,-0.01800172,-0.030757716,-0.024766698,-0.01021913,0.031417016,-0.00035338767,0.036806066,0.017213428,-0.038325317,0.026744595,-0.01000414,-0.019578304,0.009896646,0.027747875,-0.0102549605,0.018403033,0.0044144345,-0.039041948,-0.0111364145,0.02088257,0.010806765,0.0065858206,0.0010901719,0.042080455,0.01788706,0.001701098,0.012591171,0.01999395,0.0024454964,-0.013042647,-0.018618021,-0.0010203006,0.021255216,0.015149537,-0.0040883683,0.01943498,0.028407173,0.026844922,0.0045685098,0.012089531,-0.031732332,-0.0006051036,0.02161353,0.020180272,0.0118602095,0.00880737,0.021312546,0.009101188,0.0043141064,-0.009029525,-0.030729052,-0.010262127,0.0061988407,-0.0024490796,-0.010204797,-0.019649968,-0.003176458,-0.022989457,-0.0018211334,-0.011315572,-0.008277065,-0.0329936,0.007954582,0.023648757,0.010942925,0.025712648,-0.008864701,-0.0025082014,-0.007818422,-0.008965028,0.011114916,-0.041793805,-0.0048730774,-0.01805905,0.032448962,0.005342469,0.013049814,-0.006023267,0.0031334602,0.037809346,-0.030155748,0.01883301,-0.030041087,0.030958373,-0.011000255,0.0025135763,-0.007646431,0.008277065,-0.0065105744,0.0064389114,0.03505749,-0.0049626557,-0.008090741,-0.004744084,-0.010921426,-0.027246235,-0.010548779,0.008592382,-0.005933688,-0.02000828,0.013408128,-0.0032839524,0.004769166,0.0077324267,-0.027848203,-0.0082484,-0.014862886,0.035344142,0.017184764,-0.045749594,0.014060261,-0.043427717,-0.008291397,-0.027633214,0.0158375,0.0109787565,-0.0021480955,-0.026357615,-0.0047548334,-0.006249005,0.021197885,0.0019546056,0.037322037,0.032592285,-0.035745453,0.10181865,0.026371947,0.011695385,-0.06455394,-0.008628213,0.013508457,0.02961111,0.010641941,-0.014934548,-0.01589483,-0.016195815,-0.010398286,0.00026895982,0.01616715,0.00231292,0.0053532184,-0.022860466,-0.0077252607,-0.024695035,-0.012032201,-0.017772399,-0.030127084,0.0059014396,-0.016826449,-0.011394401,-0.0143469125,0.003482817,0.016668791,-0.005414132,0.021656528,0.005317387,-0.026027964,0.011910374,0.021814186,-0.01610982,0.017428417,-0.013931268,0.0007421589,0.009738988,-0.02738956,-0.009652993,0.011114916,0.0117813805,-0.010211963,0.013300634,-0.050708666,0.01255534,0.016038157,-0.01993662,-0.021814186,-0.016324809,0.0056183715,-0.025182342,-0.024193395,-0.003545522,0.006453244,0.020710578,0.0011286907,0.04827213,0.0074457754,-0.0026515273,-0.010735102,-0.0011931873,-0.0058154445,0.015335861,-0.0023863746,-0.0023057538,-0.0073812786,-0.002698108,-0.026687264,-0.021814186,0.004672421,0.04027455,0.029783102,-0.030213078,0.032964934,-0.019678632,0.037236042,-0.018030386,0.020982897,-0.00011102151,0.041736472,0.005736615,0.025297003,0.014533236,0.0022305078,0.01638214,0.008477721,0.011186578,0.016066821,-0.008635379,-0.026099628,0.0038948786,0.032190975,0.008169571,-0.012283021,-0.005700784,-0.005181228,0.0040561203,-0.04337039,0.019635634,0.012017868,-0.0069763833,0.027074244,-0.012985317,0.0067327293,0.0033681563,0.008893366,-0.022086505,-0.032420296,-0.011910374,-0.00247237,0.025039017,-0.03032774,0.017227761,-0.035745453,-0.0102549605,0.022100838,0.0002635851,0.024265058,0.019119661,-0.014655063,-0.048042808,-0.06111412,-0.051138647,0.007306033,0.047440838,0.02511068,-0.0050952323,0.028464504,-0.01527853,0.001043591,0.038525976,-0.008535052,-0.010477116,0.002619279,0.035917446,-0.0116237225,0.008922031,-0.042481765,-0.010921426,-0.010957257,-0.034082875,-0.0053460523,0.0323343,0.02655827,0.0019384815,0.025698315,0.04626557,-0.002669443,0.0035885198,-0.008821703,0.01595216,-0.0046652546,0.01761474,0.021771189,0.014690895,0.006206007,-0.0026121128,-0.02544033,0.010577444,-0.033910885,-0.007334698,-0.031359684,-0.0009710323,-0.00074529415,-0.01471956,0.0025834476,0.0001110775,0.018904673,0.021599198,0.0052063097,-0.0069262194,-0.002325461,0.058075614,-0.03600344,-0.025913304,0.0068115587,-0.0019044415,-0.005295888,-0.040933847,-0.0053711343,-0.009294678,0.015493519,0.016095487,0.014182088,-0.025626652,-0.015092206,-0.029267129,-0.018259706,-0.009882314,-0.011501895,0.020337932,0.014368411,-0.00558254,-0.0052242256,-0.006173759,0.008341561,-0.01856069,0.03439819,0.02544033,0.0075246044,-0.022258496,0.029009141,-0.0038196326,-0.034627512,-0.02422206,-0.008671211,-0.016511133,0.027102908,0.029252796,0.02489569,0.011143581,0.060254168,0.019635634,0.03789534,-0.022401823,0.030127084,0.04087652,0.0028718908,-0.02561232,-0.0023487515,-0.0045613437,-0.008599548,0.008183903,-0.002891598,0.0010856929,-0.00944517,0.017786732,-0.011172246,-0.00094684603,0.01977896,0.0022108005,-0.012913655,-0.037092716,0.0048049972,-0.011831544,0.04440233,-0.03511482,0.014748225,-0.009380674,-0.0064424947,-0.0010292584,0.008527885,-0.006818725,-0.005611205,0.0014601316,0.029582445,0.006876055,0.018102048,0.005396216,0.045032967,0.024623372,-0.04087652,-0.015780171,0.0075747683,0.02961111,-0.013565787,0.010892761,-0.009746155,0.010942925,-0.008262732,0.03161767,-0.009602829,0.017729402,-0.03927127,0.0019725214,0.021011563,-0.02233016,-0.013823774,0.0033789058,-0.008836036,-0.014303915,0.0005482212,0.018962003,0.0050307354,-0.017199095,0.0038984618,-0.01002564,-0.002250215,0.033337582,0.00095490814,-0.020538587,-0.02188585,0.0055467086,0.010269294,-0.0029399705,0.02300379,-0.008649712,0.017586075,-0.0075532696,0.019205658,-0.025297003,-0.013873938,0.0041886964,0.016482467,-0.015321528,-0.0066288183,0.028206518,0.034570184,-0.014963213,0.00336099,-0.009337676,-0.027117241,-0.008377393,-0.04761283,0.019578304,-0.008391726,-0.013902603,0.015550849,0.0027375228,-0.00977482,0.02694525,0.011272574,-0.013709113,0.0041242,-0.008062076,-0.012032201,0.013350798,0.015120871,-0.0022645476,0.0074171103,0.03660541,0.015378858,0.019592637,-0.020538587,-0.043026406,0.010606109,0.013329299,-0.003285744,-0.010362456,0.005808278,0.034942828,0.009258847,0.019879289,-0.019750295,0.0035007326,0.013565787,-0.049676724,0.019176992,0.032133643,-0.0089793615,-0.019578304,-0.02544033,0.015149537,0.031245025,-0.021771189,-0.0047261682,0.003142418,0.0141892545,-0.015235532,-0.006231089,-0.009996975,0.034856834,-0.032907605,0.008477721,0.017815396,0.0002003202,0.008169571,0.01805905,0.013558621,-0.022659808,-0.02505335,-0.0048264964,0.010233462,0.027618881,-0.0111364145,0.003176458,-0.018861676,-0.013357964,0.0028862234,0.0062418384,-0.005338886,-0.035688125,0.015020544,-0.008542217,0.0003419664,0.008148071,-0.012970985,-0.018374367,0.029754436,0.04050387,0.044259008,-0.0074457754,0.0032678281,-0.034254868,-0.011430233,-0.035946112,-0.029697105
    ];

    const rpcUrl = `${SUPABASE_URL}/rest/v1/rpc/match_website_content`;

    const res = await fetch(rpcUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        apikey: SUPABASE_SERVICE_ROLE_KEY,
        Authorization: `Bearer ${SUPABASE_SERVICE_ROLE_KEY}`,
      },
      body: JSON.stringify({
        query_embedding: testEmbedding,
        match_threshold: 0.75,
        match_count: 5,
      })
    });

    const matches = await res.json();
    return new Response(JSON.stringify({ matches }), { headers: CORS_HEADERS });
  } catch (err) {
    console.error("Vector search test error:", err);
    return new Response(JSON.stringify({ error: (err as any).message }), { status: 500, headers: CORS_HEADERS });
  }
}

export async function onRequestOptions() {
  return new Response(null, { status: 204, headers: CORS_HEADERS });
}